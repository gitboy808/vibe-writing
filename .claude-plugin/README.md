# Vibe Writing Plugin

**版本**：v1.0.0
**最后更新**：2025-12-28
**许可证**：MIT

**v1.0.0 重大更新**：
- **新架构**：Subagent 负责调研和信息整理，主 Agent 负责指令执行和验证
- **指令格式标准化**：所有 Subagent 必须返回标准指令格式
- **强制验证机制**：每条指令执行后必须验证，失败时诚实告知
- **验证机制**：Bash/Write/Edit 执行后强制验证

---

## 📦 安装

### 方式一：通过 GitHub 克隆到插件目录

```bash
# macOS/Linux
git clone https://github.com/gitboy808/vibe-writing.git
mkdir -p ~/.claude/plugins/vibe-writing
cp -r vibe-writing/.claude-plugin ~/.claude/plugins/vibe-writing/
```

### 方式二：本地测试（开发模式）

```bash
git clone https://github.com/gitboy808/vibe-writing.git
cd vibe-writing
claude --plugin-dir .
```

---

## ⚙️ 配置

### 基础配置

无需任何配置即可使用！插件会自动：

- ✅ 检测工作目录
- ✅ 识别项目意图
- ✅ 加载对应的 Agent
- ✅ 解析并执行 Subagent 返回的指令

---

## 📖 系统简介

**Vibe Writing 是一个思维协同系统，不是AI写作助手。**

**核心理念**：以人为主体性——这是**你的主题**，我是你的协同伙伴。你掌握、你选择、你决定，我激发、总结、建议、润色。

### v1.0.0 架构设计

```
┌─────────────────────────────────────────────────────────┐
│           vibe-workflow (主 Agent)                       │
│  职责：                                                  │
│  1. 检测工作目录，提取 {WORK_DIR}                        │
│  2. 读取项目信息.md                                      │
│  3. 关键词匹配路由到 Subagent                            │
│  4. 解析 Subagent 返回的指令                             │
│  5. 执行指令 + 强制验证                                   │
└───────────────────────────┬─────────────────────────────┘
                            │ Task调用
                            ▼
┌─────────────────────────────────────────────────────────┐
│              Subagent (调研+整理模式)                     │
│  learning-agent  │ structure-agent │ writing-agent │    │
│  draft-agent                                            │
│                                                             │
│  职责：                                                   │
│  - 调研、信息整理、逻辑分析                               │
│  - 生成标准指令返回给主 Agent                             │
│                                                             │
│  不做：                                                   │
│  - 直接调用 Bash/Write/Edit 工具                          │
└─────────────────────────────────────────────────────────┘
                            │
                            ▼
                   ┌─────────────────┐
                   │  项目信息.md     │
                   │  (唯一真相源)    │
                   └─────────────────┘
```

### 职责分离

| 组件 | 职责 | 不做 |
|------|------|------|
| **主 Agent** | 路由决策 + 工具执行 | 调研、信息整理 |
| **Subagent** | 调研、信息整理、逻辑分析 | 直接工具调用 |
| **项目文件** | 持久化存储 | - |

### 四阶段工作流

1. **学习阶段**（learning-agent）：对话探索，WebSearch 调研，生成知识卡片
2. **结构阶段**（structure-agent）：分析价值点，生成输出节点
3. **写作阶段**（writing-agent）：迭代优化，润色内容，组织白板
4. **成稿阶段**（draft-agent）：串联所有内容，形成完整文章

---

## 🚀 使用方式

### 方式一：自然语言（推荐）

| 输入 | 触发阶段 |
|------|----------|
| "我想写关于XX"、"探索XX" | 学习阶段 |
| "输出"、"结构化"、"分析下一步" | 结构阶段 |
| "迭代"、"润色"、"整理" | 写作阶段 |
| "成稿"、"撰写"、"最终输出" | 成稿阶段 |

### 方式二：快捷命令

| 命令 | 说明 |
|------|------|
| `/structure` | 深度分析下一步写什么 |
| `/iterate` | 进入迭代对话模式 |
| `/polish` | 直接润色当前卡片 |
| `/draft` | 生成最终成稿 |
| `/generate-card` | 提前生成知识卡片 |

---

## 📁 项目结构

```
.claude-plugin/
├── plugin.json          # Plugin 配置
├── README.md            # 本文件（安装、配置、使用指南）
├── agents/              # 4个子Agent（v1.0 调研+整理模式）
│   ├── learning-agent.md
│   ├── structure-agent.md
│   ├── writing-agent.md
│   └── draft-agent.md
├── commands/            # 5个快捷命令
├── skills/              # 核心技能
│   ├── vibe-workflow/SKILL.md  # 统筹入口（极简路由规则）
│   ├── core-specs/SKILL.md     # 核心规范
│   ├── format-check/SKILL.md   # 格式检查
│   └── canvas-rules/SKILL.md   # Canvas白板规则
└── references/          # 参考文档
    ├── README.md
    └── example-project.md
```

---

## 📋 指令格式标准

所有 Subagent 必须返回标准指令格式：

```markdown
## 【指令】创建项目目录

**命令类型**: bash
**验证命令**: ls -la "项目/股票投资学习"

```bash
mkdir -p "项目/股票投资学习/知识卡片"
```

---

## 【指令】创建项目信息.md

**命令类型**: write
**文件路径**: 项目/股票投资学习/项目信息.md
**验证读取**: true

```markdown
# 项目信息
...
```
```

### 指令类型

| 类型 | 用途 | 主 Agent 响应 |
|------|------|--------------|
| bash | 创建目录等 | 执行命令 + 验证结果 |
| write | 创建文件 | 写入文件 + 读取验证 |
| edit | 修改文件 | 执行 Edit + 读取验证 |
| read | 读取文件 | 执行 Read + 返回内容 |
| ask_user | 询问用户 | 暂停并显示问题 |
| message | 普通消息 | 直接显示给用户 |

---

## 🎯 核心原则（v1.0）

1. **Subagent 专注调研** - Subagent 负责信息收集、整理、分析，不直接执行工具
2. **主 Agent 执行指令** - 主 Agent 解析 Subagent 返回的指令，负责实际的工具调用
3. **强制验证** - 每条指令执行后必须验证，失败时诚实告知
4. **状态集中存储** - 项目信息.md 是唯一真相源
5. **上下文零污染** - 每次 Task 调用后上下文清空
6. **即装即用** - 无需配置 CLAUDE.md，自然语言直接触发
7. **来源可信优先** - WebSearch 优先从官方文档获取，整理后标注来源链接

---

## 📄 项目信息 Schema

项目根目录 `项目信息.md` 是唯一真相源：

```markdown
# [项目名]

## 基础信息
**项目名**: [项目名]
**创建时间**: [YYYY-MM-DD HH:mm]
**当前阶段**: 学习/结构/写作/成稿
**最后更新**: [YYYY-MM-DD HH:mm]

## 学习状态
**绝对轮次**: [N]
**相对轮次**: [N]
**知识卡片数**: [N]

## 输出状态
**当前正在优化**: [卡片路径] / 无
**输出卡片迭代次数**: [N]

## 知识卡片列表
1. [[知识卡片/01. xxx|01. xxx]]
2. [[知识卡片/02. xxx|02. xxx]]

## 输出卡片列表
1. [[输出卡片/主题/01-xxx|主题（迭代N次）]] ← [[知识卡片/01]]

## 待转化知识卡片
1. [[知识卡片/02. xxx|02. xxx]]

## 最终成稿
**文件路径**: [路径]
**生成时间**: [YYYY-MM-DD HH:mm]
**状态**: 已完成 / 进行中
```

### 字段维护责任

| 字段 | 维护 Agent | 更新时机 |
|------|-----------|---------|
| 基础信息 | learning-agent | 项目启动 |
| 学习状态 | learning-agent | 每轮对话/生成卡片后 |
| 输出状态 | writing-agent | 迭代/润色后 |
| 知识卡片列表 | learning-agent | 生成卡片后 |
| 输出卡片列表 | structure-agent | 生成输出卡片后 |
| 待转化列表 | structure-agent | 生成输出卡片后 |
| 最终成稿 | draft-agent | 成稿完成后 |

---

## ⚠️ 错误处理

### 标准响应

| 场景 | 响应 |
|------|------|
| Bash 失败 | 诚实告知 + 分析可能原因 |
| Write 失败 | 检查权限/路径 + 建议解决方案 |
| Edit 失败 | 回读当前内容 + 重试 |
| Subagent 超时 | 显示部分结果 + 询问是否重试 |
| 指令解析失败 | 显示原始内容 + 手动处理 |

### 断点续传

用户说"继续"时：
1. 读取 `项目信息.md`
2. 检查"当前正在优化"字段
3. 有内容 → 路由到 writing-agent
4. 为空 → 按"当前阶段"路由

---

## 👋 欢迎语（首次/无项目时）

```
欢迎来到 Vibe Writing！

这里实现真正的**人AI共创**——以你为主体，AI为你的思维伙伴：
- **学习**: 对话探索，激发灵感，总结成知识卡片
- **结构**: 分析价值点，决定讲述逻辑
- **写作**: 迭代优化，你把控内容
- **成稿**: 串联所有内容，形成完整文章

📌 可用命令：
- /structure   分析下一步写什么
- /iterate     进入迭代对话
- /polish      直接润色
- /draft       生成最终成稿
- /generate-card  提前生成卡片

开始吧，你想创作什么？
```

---

## ❓ 常见问题（FAQ）

### Q1：v1.0 和 v0.9 有什么区别？

**A**：主要变化：
- Subagent 不再直接执行工具调用，而是返回指令描述
- 主 Agent 负责解析指令并执行实际的文件操作
- 增加了强制验证机制，确保文件操作正确

### Q2：插件会自动修改我的文件吗？

**A**：不会。插件只在以下情况会创建/修改文件：
- 你明确说"开始新项目"时
- 你说"生成卡片"、"迭代"、"润色"等明确指令时
- AI 会先说明即将执行的操作

### Q3：项目文件保存在哪里？

**A**：默认保存在 `项目/[项目名]/` 目录。

### Q4：可以同时进行多个写作项目吗？

**A**：可以。每个项目都是独立的，互不干扰。

---

## 🗺️ 路线图

- [x] v0.7.0 - 自然语言触发机制
- [x] v0.8.0 - 技能描述优化
- [x] v0.9.0 - 极简路由架构
- [x] v0.9.1 - 完善 agent 权限，来源链接标注规范
- [x] v1.0.0 - 调研+执行分离架构，标准指令格式，强制验证
- [ ] v1.1.0 - 错误恢复机制

---

## 📄 许可证

MIT License

---

## 🙏 致谢

感谢所有为 Vibe Writing System 提供反馈和建议的用户！
